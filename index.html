import ccxt
import time

# Liste fixe des 5 cryptos
crypto_options = {
    '1': 'BTC/USDT',
    '2': 'ETH/USDT',
    '3': 'SOL/USDT',
    '4': 'XRP/USDT',
    '5': 'ADA/USDT'
}

# Afficher le menu de s√©lection
print("S√©lectionne la cryptomonnaie √† surveiller :")
for k, v in crypto_options.items():
    print(f"{k}. {v}")

choice = input("Entrez le num√©ro correspondant : ").strip()
selected_symbol = crypto_options.get(choice)

if not selected_symbol:
    print("Choix invalide. Fermeture.")
    exit()

print(f"\nüîç Crypto s√©lectionn√©e : {selected_symbol}")

# Liste des 10 exchanges (sans Binance, avec Bitget)
exchanges = [
    ccxt.bitget(),
    ccxt.kraken(),
    ccxt.kucoin(),
    ccxt.coinbase(),
    ccxt.bitfinex(),
    ccxt.bitstamp(),
    ccxt.gate(),
    ccxt.huobi(),
    ccxt.okx(),
    ccxt.bybit()
]

def fetch_prices(symbol):
    results = []
    for ex in exchanges:
        try:
            ticker = ex.fetch_ticker(symbol)
        except Exception:
            # Retenter avec USD si USDT √©choue
            try:
                alt_symbol = symbol.replace('USDT', 'USD')
                ticker = ex.fetch_ticker(alt_symbol)
            except:
                continue

        bid = ticker.get('bid')
        ask = ticker.get('ask')
        if bid and ask:
            results.append((ex.id, bid, ask))
    return results

# Boucle de rafra√Æchissement
while True:
    print(f"\n===== MISE √Ä JOUR ({selected_symbol}) =====")
    data = fetch_prices(selected_symbol)
    
    if not data:
        print("Aucune donn√©e r√©cup√©r√©e.")
    else:
        # Trier par prix de vente (ask) d√©croissant
        data.sort(key=lambda x: x[2], reverse=True)

        # Meilleur prix d'achat (ask le plus bas) et vente (bid le plus haut)
        min_ask = min([x[2] for x in data])
        max_bid = max([x[1] for x in data])

        print(f"üí∞ Meilleur PRIX D'ACHAT (ask le + bas) : {min_ask}")
        print(f"üí∏ Meilleur PRIX DE VENTE (bid le + haut) : {max_bid}")

        print(f"\n{'Exchange':<12} {'Bid (achat)':>15} {'Ask (vente)':>15}")
        print("-" * 45)
        for ex_id, bid, ask in data:
            print(f"{ex_id:<12} {bid:>15.6f} {ask:>15.6f}")

    print("\n‚è≥ Prochaine mise √† jour dans 60 secondes...")
    time.sleep(60)


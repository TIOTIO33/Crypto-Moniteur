<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8"><title>BTC live</title>
  <style>
    body{font-family:sans-serif;padding:20px;}
    table{border:1px solid #ccc;border-collapse:collapse;width:300px;}
    th,td{border:1px solid #ccc;padding:8px;text-align:right;}
  </style>
</head>
<body>
  <h1>Prix BTC/USD en temps réel</h1>
  <table>
    <thead><tr><th>Exchange</th><th>Prix (USD)</th></tr></thead>
    <tbody>
      <tr><td>Binance</td><td id="price-binance">…</td></tr>
      <tr><td>KuCoin</td><td id="price-kucoin">…</td></tr>
    </tbody>
  </table>
  <p id="spread">Spread : …</p>

<script>
let priceBin = null, priceKu = null;

const wsBin = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@ticker");
wsBin.onmessage = evt => {
  const d = JSON.parse(evt.data);
  priceBin = parseFloat(d.c); // dernier prix
  document.getElementById("price-binance").textContent = priceBin.toFixed(2);
  updateSpread();
};

const wsKu = new WebSocket("wss://push1-v2.kucoin.com/endpoint"); // endpoint KuCoin
wsKu.onopen = () => {
  const sub = {
    id: Date.now(),
    type: "subscribe",
    topic: "/market/ticker:BTC-USDT",
    privateChannel: false,
    response: true
  };
  wsKu.send(JSON.stringify(sub));
};
wsKu.onmessage = evt => {
  const d = JSON.parse(evt.data);
  if (d.topic && d.data) {
    priceKu = parseFloat(d.data.price);
    document.getElementById("price-kucoin").textContent = priceKu.toFixed(2);
    updateSpread();
  }
};

function updateSpread(){
  if (priceBin && priceKu) {
    const max = Math.max(priceBin, priceKu), min = Math.min(priceBin, priceKu);
    const spread = (max - min).toFixed(2),
          pct = ((max-min)/min *100).toFixed(2);
    document.getElementById("spread").textContent =
      `Spread : ${spread} USD (${pct} %)`;
  }
}
</script>
</body>
</html>

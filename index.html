<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Moniteur Crypto Trading</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=pub-9671433613114123"
        crossorigin="anonymous"></script>
    <style>
        body {
            background: #171d23;
            color: #e4e8ef;
            font-family: 'JetBrains Mono', 'Fira Mono', 'Consolas', monospace;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 36px auto;
            background: #222831;
            padding: 32px 18px;
            border-radius: 12px;
            box-shadow: 0 4px 16px #0004;
        }
        h1 {
            text-align: center;
            font-weight: 700;
            color: #00e676;
            letter-spacing: 1px;
        }
        .adsense { margin: 32px 0 16px 0; text-align: center; }
        .crypto-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0 0 0;
            font-size: 1.06em;
        }
        .crypto-table th, .crypto-table td {
            padding: 11px 6px;
            border: 1px solid #222;
            text-align: center;
        }
        .crypto-table th {
            background: #232c36;
            color: #8defff;
            font-weight: 600;
            font-size: 1em;
        }
        .crypto-table tr:nth-child(even) { background: #1b2229; }
        .crypto-table tr:hover { background: #28313a; }
        .crypto-table td.na { color: #888; font-style: italic; }
        .crypto-table .fav-star { color: #ffe066; font-size: 1.3em; }
        .crypto-table .btn { padding: 4px 10px; border: none; border-radius: 4px; cursor: pointer; }
        .crypto-table .btn-fav { background: #28240a; border: 1px solid #ffe066; color: #ffe066; }
        .crypto-table .btn-compare { background: #0e2c2c; border: 1px solid #00e676; color: #00e676; }
        .crypto-table .up { color: #00e676; font-weight: 600; }
        .crypto-table .down { color: #ff5252; font-weight: 600; }
        .crypto-table .spark { width: 80px; height: 32px; }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.9em;
            background: #232c36;
            color: #00e676;
            margin-right: 2px;
        }
        .favorites-block { margin-bottom: 18px; }
        .favorites-block h2 { font-size: 1.1em; color: #ffe066; margin-bottom: 6px; }
        .favorites-block ul { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 10px; }
        .favorites-block li { background: #232c36; border-radius: 6px; padding: 8px 14px; font-size: 1em; }
        .compare-block { background: #1d232a; border-radius: 10px; padding: 22px; margin: 24px 0; box-shadow: 0 2px 8px #0002; }
        .compare-block h2 { margin-top: 0; font-size: 1.2em; color: #8defff; }
        .compare-block table { margin-top: 10px; }
        .compare-block .btn { margin-top: 16px; }
        .footer { text-align: center; margin-top: 40px; color: #888; font-size: 0.92em; }
        .loading { color: #888; font-style: italic; }
        @media (max-width: 900px) {
            .container { padding: 8px; }
            .crypto-table th, .crypto-table td { padding: 5px; font-size: 12px; }
        }
        @media (max-width: 600px) {
            .crypto-table th, .crypto-table td { font-size: 11px; }
            .favorites-block ul { flex-direction: column; gap: 4px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà Moniteur Crypto Trading</h1>
        <div class="adsense">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-9671433613114123"
                data-ad-slot="3338450189"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="favorites-block" id="favorites-block"></div>

        <table class="crypto-table" id="crypto-table">
            <thead>
                <tr>
                    <th>Crypto</th>
                    <th>Prix Moy.</th>
                    <th>Bitget</th>
                    <th>Coinbase</th>
                    <th>Kraken</th>
                    <th>OKX</th>
                    <th>KuCoin</th>
                    <th>Gate.io</th>
                    <th>Huobi</th>
                    <th>Crypto.com</th>
                    <th>Bitstamp</th>
                    <th>MEXC</th>
                    <th>Graph</th>
                    <th>Favori</th>
                    <th>Comparer</th>
                </tr>
            </thead>
            <tbody id="crypto-tbody">
                <tr><td colspan="15" class="loading">Chargement...</td></tr>
            </tbody>
        </table>

        <div id="compare-block"></div>

        <div class="footer">
            ¬© 2025 Moniteur Crypto Pro ‚Äì Donn√©es APIs publiques, annonces Google AdSense.<br>
            <small>UI trading sombre, actualisation chaque minute, graphiques dynamiques.</small>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sparkline-canvas@3.1.0/dist/sparkline.min.js"></script>
    <script>
    // --- Configuration ---
    const CRYPTOS = [
        {id: "bitcoin", symbol: "BTC", name: "Bitcoin", icon: "‚Çø"},
        {id: "ethereum", symbol: "ETH", name: "Ethereum", icon: "Œû"},
        {id: "binancecoin", symbol: "BNB", name: "Binance Coin", icon: "‚ö°"},
        {id: "solana", symbol: "SOL", name: "Solana", icon: "‚óé"},
        {id: "cardano", symbol: "ADA", name: "Cardano", icon: "‚Ç≥"},
        {id: "ripple", symbol: "XRP", name: "XRP", icon: "‚úï"},
        {id: "dogecoin", symbol: "DOGE", name: "Dogecoin", icon: "√ê"},
    ];
    const EXCHANGES = [
        {id:"bitget", name:"Bitget", logo:"üî∏", url:"https://api.bitget.com/api/v2/spot/market/tickers?symbol={symbol}USDT", extract: d => d.data?.[0]?.lastPr},
        {id:"coinbase", name:"Coinbase", logo:"üîµ", url:"https://api.coinbase.com/v2/prices/{symbol}-USD/spot", extract: d => d.data?.amount},
        {id:"kraken", name:"Kraken", logo:"üêô", url:"https://api.kraken.com/0/public/Ticker?pair={kraken_symbol}USDT", extract: d => {
            const r = d.result; if (!r) return null;
            for (let k in r) if (r[k]?.c?.[0]) return r[k].c[0];
            return null;
        }},
        {id:"okx", name:"OKX", logo:"‚ö´", url:"https://www.okx.com/api/v5/market/ticker?instId={symbol}-USDT", extract: d => d.data?.[0]?.last},
        {id:"kucoin", name:"KuCoin", logo:"üü¢", url:"https://api.kucoin.com/api/v1/market/orderbook/level1?symbol={symbol}-USDT", extract: d => d.data?.price},
        {id:"gate", name:"Gate.io", logo:"üö™", url:"https://api.gateio.ws/api/v4/spot/tickers?currency_pair={symbol}_USDT", extract: d => d?.[0]?.last},
        {id:"huobi", name:"Huobi (HTX)", logo:"üî¥", url:"https://api.huobi.pro/market/detail/merged?symbol={symbol_lower}usdt", extract: d => d.tick?.close},
        {id:"crypto_com", name:"Crypto.com", logo:"üíé", url:"https://api.crypto.com/v2/public/get-ticker?instrument_name={symbol}_USDT", extract: d => d.result?.data?.[0]?.a || d.result?.data?.[0]?.last},
        {id:"bitstamp", name:"Bitstamp", logo:"üü´", url:"https://www.bitstamp.net/api/v2/ticker/{symbol_lower}usd", extract: d => d.last},
        {id:"mexc", name:"MEXC", logo:"üî∑", url:"https://api.mexc.com/api/v3/ticker/price?symbol={symbol}USDT", extract: d => d.price},
    ];
    // --- Utilitaires ---
    function symbolVars(symbol) {
        return {
            symbol,
            symbol_lower: symbol.toLowerCase(),
            kraken_symbol: symbol === "BTC" ? "XBT" : symbol,
        };
    }
    function buildUrl(exchange, symbol) {
        let url = exchange.url;
        const vars = symbolVars(symbol);
        for (let k in vars) url = url.replaceAll(`{${k}}`, vars[k]);
        return url;
    }
    function formatPrice(p) {
        if (!p || isNaN(p)) return "<span class='na'>N/A</span>";
        p = parseFloat(p);
        if (p < 1) return p.toFixed(6);
        if (p < 100) return p.toFixed(4);
        return p.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }
    function color24h(val) {
        if (val > 0) return `<span class="up">+${val.toFixed(2)}%</span>`;
        if (val < 0) return `<span class="down">${val.toFixed(2)}%</span>`;
        return `<span>${val.toFixed(2)}%</span>`;
    }
    function getFavorites() {
        try { return JSON.parse(localStorage.getItem("crypto_favs")||"[]"); } catch { return []; }
    }
    function setFavorites(favs) {
        localStorage.setItem("crypto_favs", JSON.stringify(favs));
    }
    function average(arr) {
        if (!arr.length) return null;
        return arr.reduce((a,b)=>a+parseFloat(b),0)/arr.length;
    }
    // --- Graphiques miniatures (sparklines) ---
    async function fetchHistory(cryptoId) {
        try {
            const r = await fetch(`https://api.coingecko.com/api/v3/coins/${cryptoId}/market_chart?vs_currency=usd&days=1&interval=hourly`);
            const d = await r.json();
            return d.prices.map(x=>x[1]);
        } catch { return []; }
    }
    function drawSpark(canvas, data) {
        if (!canvas || !data?.length) return;
        Sparkline.draw(canvas, data, { stroke: "#00e676", fill: "#003f2d", min: Math.min(...data), max: Math.max(...data) });
    }
    // --- Affichage ---
    function renderTable(data) {
        const favs = getFavorites();
        let html = "";
        for (const c of CRYPTOS) {
            const row = data[c.id] || {};
            const avg = row.prices ? average(Object.values(row.prices)) : null;
            html += `<tr>
                <td>${c.icon} <b>${c.name}</b> <span style="color:#888">(${c.symbol})</span></td>
                <td><b>$${formatPrice(avg)}</b></td>`;
            for (const ex of EXCHANGES) {
                html += `<td>${row.prices && row.prices[ex.id] ? "$"+formatPrice(row.prices[ex.id]) : "<span class='na'>N/A</span>"}</td>`;
            }
            html += `<td><canvas class="spark" id="spark-${c.id}"></canvas></td>
            <td>
                <button class="btn btn-fav" onclick="toggleFav('${c.id}')">
                    ${favs.includes(c.id) ? '<span class="fav-star">‚òÖ</span>' : '‚òÜ'}
                </button>
            </td>
            <td>
                <button class="btn btn-compare" onclick="showCompare('${c.id}')">üîç</button>
            </td>
            </tr>`;
        }
        document.getElementById('crypto-tbody').innerHTML = html;
        renderFavorites(data);
        // Sparklines
        CRYPTOS.forEach(async c => {
            const dataHist = await fetchHistory(c.id);
            const canvas = document.getElementById(`spark-${c.id}`);
            drawSpark(canvas, dataHist);
        });
    }
    function renderFavorites(data) {
        const favs = getFavorites();
        if (!favs.length) {
            document.getElementById('favorites-block').innerHTML = '';
            return;
        }
        let html = `<h2>‚≠ê Vos favoris</h2><ul>`;
        for (const id of favs) {
            const c = CRYPTOS.find(x => x.id === id);
            if (!c) continue;
            const avg = data[id]?.prices ? average(Object.values(data[id].prices)) : null;
            html += `<li>${c.icon} <b>${c.name}</b> (${c.symbol}) ‚Äî <b>$${formatPrice(avg)}</b></li>`;
        }
        html += `</ul>`;
        document.getElementById('favorites-block').innerHTML = html;
    }
    function showCompare(cryptoId) {
        const c = CRYPTOS.find(x => x.id === cryptoId);
        if (!c) return;
        const row = window.CRYPTO_DATA[cryptoId];
        if (!row || !row.prices) {
            document.getElementById('compare-block').innerHTML = `<div class="compare-block"><b>Aucune donn√©e pour ${c.name}</b></div>`;
            return;
        }
        const prices = Object.entries(row.prices).map(([exid, price]) => {
            const ex = EXCHANGES.find(e=>e.id===exid);
            return {ex, price:parseFloat(price)};
        }).filter(x=>x.price);
        if (!prices.length) {
            document.getElementById('compare-block').innerHTML = `<div class="compare-block"><b>Aucune donn√©e pour ${c.name}</b></div>`;
            return;
        }
        prices.sort((a,b)=>b.price-a.price);
        const highest = prices[0];
        const lowest = prices[prices.length-1];
        const avg = average(prices.map(x=>x.price));
        const spread = highest.price - lowest.price;
        const spreadPct = avg ? (spread/avg*100) : 0;
        let html = `<div class="compare-block">
            <h2>üîç Comparateur ‚Äî ${c.icon} ${c.name} (${c.symbol})</h2>
            <b>Prix le plus haut :</b> $${formatPrice(highest.price)} (${highest.ex.name})<br>
            <b>Prix le plus bas :</b> $${formatPrice(lowest.price)} (${lowest.ex.name})<br>
            <b>√âcart (spread) :</b> $${formatPrice(spread)} (${spreadPct.toFixed(2)}%)<br>
            <b>Prix moyen :</b> $${formatPrice(avg)}<br>
            <br>
            <table class="crypto-table">
                <tr><th>Exchange</th><th>Prix</th><th>√âcart vs Moyenne</th></tr>`;
        for (const p of prices) {
            const dev = p.price - avg;
            const devPct = avg ? (dev/avg*100) : 0;
            let status = "";
            if (p.price === highest.price) status = "üü¢";
            if (p.price === lowest.price) status = "üî¥";
            html += `<tr>
                <td>${p.ex.logo} ${p.ex.name}</td>
                <td>$${formatPrice(p.price)}</td>
                <td>${dev>=0?"+":""}${devPct.toFixed(2)}% ${status}</td>
            </tr>`;
        }
        html += `</table>
            <button class="btn" onclick="closeCompare()">Fermer</button>
        </div>`;
        document.getElementById('compare-block').innerHTML = html;
        window.scrollTo({top:document.getElementById('compare-block').offsetTop-20, behavior:'smooth'});
    }
    function closeCompare() {
        document.getElementById('compare-block').innerHTML = "";
    }
    window.toggleFav = function(id) {
        let favs = getFavorites();
        if (favs.includes(id)) favs = favs.filter(x=>x!==id);
        else favs.push(id);
        setFavorites(favs);
        renderTable(window.CRYPTO_DATA);
    }
    window.showCompare = showCompare;
    window.closeCompare = closeCompare;
    async function fetchAll() {
        const data = {};
        for (const c of CRYPTOS) {
            data[c.id] = {prices:{}};
        }
        await Promise.all(CRYPTOS.map(async c => {
            await Promise.all(EXCHANGES.map(async ex => {
                try {
                    const url = buildUrl(ex, c.symbol);
                    const r = await fetch(url, {headers: {'Accept':'application/json'}});
                    const d = await r.json();
                    const price = ex.extract(d);
                    if (price && !isNaN(price)) data[c.id].prices[ex.id] = parseFloat(price);
                } catch (e) {}
            }));
        }));
        window.CRYPTO_DATA = data;
        renderTable(data);
    }
    document.getElementById('crypto-tbody').innerHTML = `<tr><td colspan="15" class="loading">Chargement...</td></tr>`;
    window.CRYPTO_DATA = {};
    fetchAll();
    setInterval(fetchAll, 60000); // actualisation toutes les 60s
    </script>
</body>
</html>

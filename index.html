from flask import Flask, render_template_string, jsonify
import ccxt

app = Flask(__name__)

# Configuration des exchanges
exchanges = {
    'binance': ccxt.binance(),
    'coinbase': ccxt.coinbase(),
    'kraken': ccxt.kraken()
}

# Symboles √† surveiller
symbols = ['BTC/USDT', 'ETH/USDT']

# Fonction pour r√©cup√©rer les prix
def fetch_prices():
    data = {}
    for name, exchange in exchanges.items():
        data[name] = {}
        for symbol in symbols:
            try:
                ticker = exchange.fetch_ticker(symbol)
                data[name][symbol] = ticker['last']
            except Exception as e:
                data[name][symbol] = f"Erreur: {str(e)}"
    return data

# Page HTML int√©gr√©e
html_template = """
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Crypto Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background-color: #121212;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #1e1e1e;
        }
        th, td {
            border: 1px solid #333;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #222;
        }
    </style>
</head>
<body>
    <h1>üìà Moniteur Crypto Multi-Exchange</h1>
    <table id="priceTable">
        <thead>
            <tr>
                <th>Exchange</th>
                <th>BTC/USDT</th>
                <th>ETH/USDT</th>
            </tr>
        </thead>
        <tbody id="priceBody">
        </tbody>
    </table>

    <script>
        async function loadPrices() {
            const response = await fetch("/prices");
            const data = await response.json();
            const tbody = document.getElementById("priceBody");
            tbody.innerHTML = "";

            for (const exchange in data) {
                const row = document.createElement("tr");
                const nameCell = document.createElement("td");
                nameCell.textContent = exchange;
                row.appendChild(nameCell);

                ["BTC/USDT", "ETH/USDT"].forEach(symbol => {
                    const cell = document.createElement("td");
                    cell.textContent = data[exchange][symbol];
                    row.appendChild(cell);
                });

                tbody.appendChild(row);
            }
        }

        setInterval(loadPrices, 5000);
        loadPrices();
    </script>
</body>
</html>
"""

@app.route("/")
def index():
    return render_template_string(html_template)

@app.route("/prices")
def prices():
    return jsonify(fetch_prices())

if __name__ == "__main__":
    app.run(debug=True)

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comparateur Prix Crypto</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg-light:rgba(255,255,255,0.9);--text-light:#111;--table-light:rgba(255,255,255,0.85);--bg-dark:rgba(10,10,10,0.9);--text-dark:#f1f1f1;--table-dark:rgba(0,0,0,0.75);}
    body{margin:0;font-family:'Inter',sans-serif;transition:0.3s;}
    body.light-mode{background:var(--bg-light);color:var(--text-light);}
    body:not(.light-mode){background:var(--bg-dark);color:var(--text-dark);}
    .container{max-width:900px;margin:auto;padding:20px;}
    select{padding:8px;font-size:1rem;margin:10px;}
    .tradingview-widget{width:100%;height:350px;border:1px solid #ccc;border-radius:10px;overflow:hidden;margin-bottom:20px;}
    table{width:100%;border-collapse:collapse;margin-top:10px;background:var(--table-dark);border-radius:8px;overflow:hidden;}
    body.light-mode table{background:var(--table-light);}
    th,td{padding:12px;text-align:center;border:1px solid #444;}
    th{background:#333;color:#fff;}
    body.light-mode th{background:#eee;color:#000;}
    tr:hover{background:var(--table-dark);}
    body.light-mode tr:hover{background:var(--table-light);}
    td.green{color:#0f0;font-weight:600;} td.red{color:#f33;}
    #spread{margin-top:10px;font-size:1.1rem;font-weight:600;text-align:center;}
    button{position:fixed;top:20px;right:20px;padding:8px;font-size:1rem;cursor:pointer;}
  </style>
</head>
<body class="light-mode">
  <button id="toggle-theme">ðŸŒ™ Mode sombre</button>
  <div class="container">
    <h1>Comparateur Prix Crypto</h1>
    <label for="symbol">SÃ©lectionne une crypto :</label>
    <select id="symbol">
      <option value="BTCUSDT">Bitcoin (BTC)</option>
      <option value="ETHUSDT">Ethereum (ETH)</option>
      <option value="BNBUSDT">Binance Coin (BNB)</option>
      <option value="XRPUSDT">XRP (XRP)</option>
      <option value="ADAUSDT">Cardano (ADA)</option>
      <option value="SOLUSDT">Solana (SOL)</option>
      <option value="DOGEUSDT">Dogecoin (DOGE)</option>
      <option value="SHIBUSDT">Shiba Inu (SHIB)</option>
      <option value="LTCUSDT">Litecoin (LTC)</option>
      <option value="LINKUSDT">Chainlink (LINK)</option>
      <option value="AVAXUSDT">Avalanche (AVAX)</option>
      <option value="DOTUSDT">Polkadot (DOT)</option>
      <option value="TRXUSDT">Tron (TRX)</option>
      <option value="XMRUSDT">Monero (XMR)</option>
      <option value="UNIUSDT">Uniswap (UNI)</option>
      <option value="USDCUSDT">USD Coin (USDC)</option>
      <option value="USDTUSDT">Tether (USDT)</option>
      <option value="BCHUSDT">Bitcoin Cash (BCH)</option>
      <option value="XLMUSDT">Stellar (XLM)</option>
      <option value="FILUSDT">Filecoin (FIL)</option>
    </select>

    <div class="tradingview-widget" id="chart-div">
      <iframe id="tvchart" src="" frameborder="0" scrolling="no"></iframe>
    </div>

    <table>
      <thead><tr><th>Exchange</th><th>Prix</th></tr></thead>
      <tbody id="price-table"></tbody>
    </table>
    <div id="spread"></div>
  </div>

  <script>
    const exps = [
      {name:'Binance',url:s=>`https://api.binance.com/api/v3/ticker/price?symbol=${s}`,parse:r=>parseFloat(r.price)},
      {name:'Coinbase',url:s=>s.startsWith('USDT')?`https://api.coinbase.com/v2/prices/${s.slice(0,-4)}-USD/spot`:null,parse:r=>parseFloat(r.data.amount)},
      // autres exchanges compatibles USDT...
    ];
    const symbolSelect=document.getElementById('symbol');
    const chartFrame=document.getElementById('tvchart');
    function updateChart(sym){
      const pair=sym.replace('USDT','');
      chartFrame.src=`https://s.tradingview.com/widgetembed/?symbol=BINANCE:${sym}&interval=1&theme=`+(document.body.classList.contains('light-mode')?'light':'dark');
    }
    async function updatePrices(){
      const sym=symbolSelect.value;
      const tbody=document.getElementById('price-table'); tbody.innerHTML='';
      const prices=[];
      for(const ex of exps){
        try{
          const res=await fetch(ex.url(sym));
          const d=await res.json();
          const p=ex.parse(d);
          prices.push(p);
          const tr=document.createElement('tr');
          tr.innerHTML=`<td>${ex.name}</td><td class="green">${p.toFixed(4)}</td>`;
          tbody.appendChild(tr);
        }catch{
          const tr=document.createElement('tr'); tr.innerHTML=`<td>${ex.name}</td><td class="red">Erreur</td>`;
          tbody.appendChild(tr);
        }
      }
      if(prices.length>1){
        const mn=Math.min(...prices), mx=Math.max(...prices);
        const spread=(mx-mn), pct=spread/mn*100;
        document.getElementById('spread').textContent=`Spread : ${spread.toFixed(4)} USDT (${pct.toFixed(2)}%)`;
      }
    }
    symbolSelect.addEventListener('change',()=>{
      updateChart(symbolSelect.value);
      updatePrices();
    });
    document.getElementById('toggle-theme').onclick=()=>{
      document.body.classList.toggle('light-mode');
      updateChart(symbolSelect.value);
    };
    // init
    updateChart(symbolSelect.value);
    updatePrices();
    setInterval(updatePrices,60000);
  </script>
</body>
</html>

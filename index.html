<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Moniteur Crypto - Interface Web</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 0; }
        header, footer { background: #222; color: #fff; padding: 20px; text-align: center; }
        h1, h2 { color: #222; }
        .container { max-width: 1200px; margin: 30px auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 8px #ddd; }
        .crypto-table, .exchange-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .crypto-table th, .crypto-table td, .exchange-table th, .exchange-table td { padding: 10px; border: 1px solid #eee; text-align: center; }
        .crypto-table th, .exchange-table th { background: #f0f0f0; }
        .favorite { color: gold; font-weight: bold; }
        .icon { font-size: 1.4em; }
        .section { margin-bottom: 40px; }
    </style>
</head>
<body>
    <header>
        <h1>🚀 MONITEUR CRYPTO - INTERFACE WEB</h1>
        <p>✨ Exchanges (hors Binance/Bybit) | 7 Cryptomonnaies | APIs Publiques Gratuites</p>
    </header>
    <div class="container">
        <!-- Sections existantes -->

        <section class="section">
            <h2>Vue d'ensemble des Cryptomonnaies</h2>
            <table class="crypto-table">
                <thead>
                    <tr>
                        <th>Crypto</th><th>Prix Moy.</th><th>Bitget</th><th>Coinbase</th><th>Kraken</th><th>OKX</th>
                        <th>KuCoin</th><th>Gate.io</th><th>Huobi (HTX)</th><th>Crypto.com</th><th>Bitstamp</th><th>MEXC</th><th>Favori</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Lignes générées dynamiquement -->
                </tbody>
            </table>
        </section>
    </div>
    <footer>
        <p>👋 Merci d'utiliser le Moniteur Crypto !</p>
    </footer>

    <script>
    const exchanges = {
        bitget: { url: 'https://api.bitget.com/api/spot/v1/market/tickers?symbol=', parse: data => data.data },
        coinbase: { url: 'https://api.coinbase.com/v2/exchange-rates?currency=', parse: data => data.data.rates },
        kraken: { url: 'https://api.kraken.com/0/public/Ticker?pair=', parse: data => data.result },
        okx: { url: 'https://www.okx.com/api/v5/market/ticker?instId=', parse: data => data.data[0] },
        kucoin: { url: 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=', parse: data => data.data },
        gate: { url: 'https://api.gate.io/api/v4/spot/tickers?currency_pair=', parse: data => data[0] },
        huobi: { url: 'https://api.huobi.pro/market/detail/merged?symbol=', parse: data => data.tick },
        cryptocom: { url: 'https://api.crypto.com/v2/public/get-ticker?instrument_name=', parse: data => data.result.data[0] },
        bitstamp: { url: 'https://www.bitstamp.net/api/v2/ticker/', parse: data => data },
        mexc: { url: 'https://api.mexc.com/api/v3/ticker/price?symbol=', parse: data => data }
    };

    const cryptos = [
        { id: 'BTCUSDT', name: 'Bitcoin', icon: '₿' },
        { id: 'ETHUSDT', name: 'Ethereum', icon: 'Ξ' },
        { id: 'BNBUSDT', name: 'Binance Coin', icon: '⚡' },
        { id: 'SOLUSDT', name: 'Solana', icon: '◎' },
        { id: 'ADAUSDT', name: 'Cardano', icon: '₳' },
        { id: 'XRPUSDT', name: 'XRP', icon: '✕' },
        { id: 'DOGEUSDT', name: 'Dogecoin', icon: 'Ð' }
    ];

    const tbody = document.querySelector('.crypto-table tbody');

    function buildRows() {
        tbody.innerHTML = '';
        cryptos.forEach(c => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><span class="icon">${c.icon}</span> ${c.name}</td>
                <td class="avg">--</td>
                ${Object.keys(exchanges).map(e => `<td class="${e}">--</td>`).join('')}
                <td><span class="favorite">☆</span></td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function updatePrices() {
        buildRows();
        for (const crypto of cryptos) {
            const prices = [];
            for (const [ex, cfg] of Object.entries(exchanges)) {
                try {
                    const pair = crypto.id;
                    const url = cfg.url + pair;
                    const res = await fetch(url);
                    const data = await res.json();
                    let price = null;
                    // parsing par exchange
                    switch (ex) {
                        case 'bitget': price = cfg.parse(data).find(t => t.symbol === pair)?.last; break;
                        case 'coinbase': price = 1 / parseFloat(cfg.parse(data)[crypto.id.replace('USDT','')]); break;
                        case 'kraken': {
                            const key = Object.keys(data.result)[0];
                            price = data.result[key].c[0];
                        } break;
                        case 'okx': price = cfg.parse(data).last;
                        case 'kucoin': price = cfg.parse(data).price; break;
                        case 'gate': price = cfg.parse(data).last;
                        case 'huobi': price = cfg.parse(data).close;
                        case 'cryptocom': price = cfg.parse(data).i === pair ? cfg.parse(data).a : null; break;
                        case 'bitstamp': price = cfg.parse(data).last; break;
                        case 'mexc': price = cfg.parse(data).price; break;
                    }
                    if (price) {
                        const cell = document.querySelector(`.${ex}:nth-child(${2 + Object.keys(exchanges).indexOf(ex) + 1})`);
                        cell.innerText = '$' + parseFloat(price).toFixed(2);
                        prices.push(parseFloat(price));
                    }
                } catch (e) { console.error(ex, crypto.id, e); }
            }
            if (prices.length) {
                const avg = (prices.reduce((a, b) => a + b, 0) / prices.length).toFixed(2);
                tbody.querySelector('tr:last-child .avg').innerText = '$' + avg;
            }
        }
    }

    updatePrices();
    setInterval(updatePrices, 60000);
    </script>
</body>
</html>
